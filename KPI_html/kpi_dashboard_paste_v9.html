
<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>KPI Dashboard v9ï¼ˆæ¯”ç‡è¿½åŠ ãƒ»å°å‹ã‚°ãƒ©ãƒ•ï¼‹PNGä¿å­˜ï¼‹è²¼ã‚Šä»˜ã‘å–è¾¼ï¼‰</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body{font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Noto Sans JP", "Meiryo", sans-serif; margin:16px;}
    h1{margin:8px 0 12px}
    section{margin:18px 0}
    .charts{display:grid;grid-template-columns:repeat(2, minmax(320px, 1fr));gap:16px}
    .panel{border:1px solid #ddd;border-radius:10px;padding:10px}
    .panel h3{margin:0 0 8px;display:flex;justify-content:space-between;align-items:center;font-size:16px}
    .btn{font-size:12px;padding:6px 10px;border:1px solid #bbb;border-radius:8px;background:#fff;cursor:pointer}
    table{border-collapse:collapse;width:100%}
    th,td{border:1px solid #ccc;padding:4px 6px;text-align:right}
    th:first-child,td:first-child{text-align:left}
    input[type=number]{width:100%;box-sizing:border-box}
    textarea{width:100%;height:120px;box-sizing:border-box}
  </style>
</head>
<body>
  <h1>å—ç™ºæ³¨èª² KPI ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h1>

  <section class="panel">
    <h3>è²¼ã‚Šä»˜ã‘ã¦å–è¾¼ <button class="btn" id="btnImport">â¬ å–è¾¼</button></h3>
    <div>1è¡Œç›®ã€Œæœˆã€ã€2è¡Œç›®ä»¥é™ã€Œæ®‹æ¥­æ™‚é–“ / å—æ³¨ä»¶æ•° / ç€ä¿¡æ•°/æ—¥ / å—ä¿¡æ•°/æ—¥ / å¿œç­”ç‡ / å—ç™ºæ³¨èª²å‡¦ç†æ¯”ç‡ã€ã€‚<br>Excelç­‰ã‹ã‚‰ãã®ã¾ã¾ <b>ã‚¿ãƒ–åŒºåˆ‡ã‚Š</b> ã§è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ï¼ˆç©ºæ¬„OKï¼‰ã€‚åŒã˜æœˆã¯ä¸Šæ›¸ãã€æ–°ã—ã„æœˆã¯å³ç«¯ã«è¿½åŠ ã—ã¾ã™ã€‚</div>
    <textarea id="pasteArea" placeholder="æœˆ	Jan-25	Feb-25	...
æ®‹æ¥­æ™‚é–“	12.7	12.7	...
å—æ³¨ä»¶æ•°	23216	22600	...
ç€ä¿¡æ•°/æ—¥		2208	...
å—ä¿¡æ•°/æ—¥	2195	2103	...
å¿œç­”ç‡	95.3	96.4	...
å—ç™ºæ³¨èª²å‡¦ç†æ¯”ç‡	74.2	75.3	..."></textarea>
  </section>

  <section class="panel">
    <h3>ã‚°ãƒ©ãƒ•</h3>
    <div class="charts">
      <div class="panel">
        <h3><span>æ®‹æ¥­æ™‚é–“ï¼ˆå·¦è»¸ãƒ»hï¼‰Ã— å—æ³¨ä»¶æ•°ï¼ˆå³è»¸ãƒ»ä»¶ï¼‰</span>
          <button class="btn" data-png="chart_ov_orders">ğŸ–¼ PNG</button>
        </h3>
        <canvas id="chart_ov_orders" width="480" height="220"></canvas>
      </div>
      <div class="panel">
        <h3><span>ç€ä¿¡æ•° / æ—¥</span>
          <button class="btn" data-png="chart_inbound">ğŸ–¼ PNG</button>
        </h3>
        <canvas id="chart_inbound" width="480" height="220"></canvas>
      </div>
      <div class="panel">
        <h3><span>å—ä¿¡æ•° / æ—¥</span>
          <button class="btn" data-png="chart_received">ğŸ–¼ PNG</button>
        </h3>
        <canvas id="chart_received" width="480" height="220"></canvas>
      </div>
      <div class="panel">
        <h3><span>å¿œç­”ç‡</span>
          <button class="btn" data-png="chart_rate">ğŸ–¼ PNG</button>
        </h3>
        <canvas id="chart_rate" width="480" height="220"></canvas>
      </div>
      <div class="panel">
        <h3><span>å—ç™ºæ³¨èª²å‡¦ç†æ¯”ç‡</span>
          <button class="btn" data-png="chart_ratio">ğŸ–¼ PNG</button>
        </h3>
        <canvas id="chart_ratio" width="480" height="220"></canvas>
      </div>
    </div>
  </section>

  <section class="panel">
    <h3>ç·¨é›†ãƒ†ãƒ¼ãƒ–ãƒ«</h3>
    <div id="tableWrap"></div>
  </section>

  <script>
    // åˆæœŸãƒ‡ãƒ¼ã‚¿ï¼ˆ8ãƒ¶æœˆç›®ã¾ã§ï¼‰
    let months=['Jan-25','Feb-25','Mar-25','Apr-25','May-25','Jun-25','Jul-25','Aug-25'];
    let data={
      overtime:[12.7,12.7,11.5,12.7,11.5,13.2,13.9,9.1],
      orders:[23216,22600,22811,23489,23101,24224,26981,18883],
      inbound:[null,2208,2037,2022,1994,2196,2197,2089],
      received:[2195,2103,1830,1918,1776,2077,2078,1974],
      answerRT:[95.3,96.4,94.6,94.9,94.6,94.6,94.6,94.48],
      ratio:[74.2,75.3,74.1,74.5,76.5,75.8,77.4,77.3]
    };

    // å–è¾¼ï¼ˆã‚¿ãƒ–åŒºåˆ‡ã‚Šï¼‰
    function parsePasted(text){
      const lines = text.replace(/\r\n/g,'\n').replace(/\r/g,'\n').split('\n').filter(s=>s.trim()!=='');
      const rows = lines.map(line=> line.split('\t'));
      if(rows.length<2) return;
      const newMonths = rows[0].slice(1).map(s=>String(s||'').trim()).filter(Boolean);
      const map={'æ®‹æ¥­æ™‚é–“':'overtime','å—æ³¨ä»¶æ•°':'orders','ç€ä¿¡æ•°/æ—¥':'inbound','å—ä¿¡æ•°/æ—¥':'received','å¿œç­”ç‡':'answerRT','å—ç™ºæ³¨èª²å‡¦ç†æ¯”ç‡':'ratio'};
      const next={overtime:[],orders:[],inbound:[],received:[],answerRT:[],ratio:[]};
      for(const r of rows.slice(1)){
        const key=map[(r[0]||'').trim()]; if(!key) continue;
        next[key]=r.slice(1).map(x=>{
          const t=String(x??'').trim().replace(/,/g,'');
          if(t==='') return null;
          const n=Number(t); return Number.isFinite(n)?n:null;
        });
      }
      // å³ã«æ‹¡å¼µï¼åŒåã¯ä¸Šæ›¸ã
      const idx=new Map(months.map((m,i)=>[m,i]));
      for(let i=0;i<newMonths.length;i++){
        const m=newMonths[i];
        if(idx.has(m)){
          const k=idx.get(m);
          ['overtime','orders','inbound','received','answerRT','ratio'].forEach(s=>data[s][k]=next[s][i]??null);
        }else{
          months.push(m);
          ['overtime','orders','inbound','received','answerRT','ratio'].forEach(s=>data[s].push(next[s][i]??null));
        }
      }
    }

    document.getElementById('btnImport').addEventListener('click',()=>{
      const t=document.getElementById('pasteArea').value;
      if(!t.trim()) { alert('è²¼ã‚Šä»˜ã‘ãƒ‡ãƒ¼ã‚¿ãŒç©ºã§ã™'); return; }
      parsePasted(t); buildTable(); renderCharts();
    });

    // ãƒ†ãƒ¼ãƒ–ãƒ«
    function buildTable(){
      const wrap=document.getElementById('tableWrap'); wrap.innerHTML='';
      const tbl=document.createElement('table');
      const thead=document.createElement('thead');
      const trh=document.createElement('tr');
      const th0=document.createElement('th'); th0.textContent='KPI/æœˆ'; trh.appendChild(th0);
      for(const m of months){ const th=document.createElement('th'); th.textContent=m; trh.appendChild(th); }
      thead.appendChild(trh); tbl.appendChild(thead);
      const tbody=document.createElement('tbody');
      const defs=[['æ®‹æ¥­æ™‚é–“','overtime'],['å—æ³¨ä»¶æ•°','orders'],['ç€ä¿¡æ•° / æ—¥','inbound'],['å—ä¿¡æ•° / æ—¥','received'],['å¿œç­”ç‡','answerRT'],['å—ç™ºæ³¨èª²å‡¦ç†æ¯”ç‡','ratio']];
      for(const [label,key] of defs){
        const tr=document.createElement('tr');
        const th=document.createElement('th'); th.textContent=label; tr.appendChild(th);
        for(let i=0;i<months.length;i++){
          const td=document.createElement('td');
          const inp=document.createElement('input'); inp.type='number'; inp.step='any';
          const v=data[key][i]; inp.value = (v==null||isNaN(v))? '' : String(v);
          inp.addEventListener('input',()=>{ data[key][i]=inp.value===''?null:Number(inp.value); renderCharts(); });
          td.appendChild(inp); tr.appendChild(td);
        }
        tbody.appendChild(tr);
      }
      tbl.appendChild(tbody); wrap.appendChild(tbl);
    }

    // ã‚°ãƒ©ãƒ•
    let charts=[];
    function renderCharts(){
      charts.forEach(c=>c?.destroy()); charts=[];
      const labels=months.map(m=>m.replace('-25',''));
      const lineCommon={tension:.35,borderWidth:2,pointRadius:3,pointHoverRadius:5,fill:false};

      charts.push(new Chart(document.getElementById('chart_ov_orders').getContext('2d'),{
        type:'line',
        data:{labels, datasets:[
          {label:'æ®‹æ¥­æ™‚é–“ï¼ˆhï¼‰',data:data.overtime,yAxisID:'yL',borderColor:'#2b8a3e',...lineCommon},
          {label:'å—æ³¨ä»¶æ•°ï¼ˆä»¶ï¼‰',data:data.orders,yAxisID:'yR',borderColor:'#1c7ed6',...lineCommon},
        ]},
        options:{responsive:false,maintainAspectRatio:false,interaction:{mode:'index',intersect:false},
          scales:{yL:{type:'linear',position:'left'},yR:{type:'linear',position:'right'}}}
      }));

      charts.push(new Chart(document.getElementById('chart_inbound').getContext('2d'),{
        type:'line',
        data:{labels,datasets:[{label:'ç€ä¿¡/æ—¥',data:data.inbound,borderColor:'#f59f00',...lineCommon}]},
        options:{responsive:false,maintainAspectRatio:false}
      }));

      charts.push(new Chart(document.getElementById('chart_received').getContext('2d'),{
        type:'line',
        data:{labels,datasets:[{label:'å—ä¿¡/æ—¥',data:data.received,borderColor:'#e03131',...lineCommon}]},
        options:{responsive:false,maintainAspectRatio:false}
      }));

      charts.push(new Chart(document.getElementById('chart_rate').getContext('2d'),{
        type:'line',
        data:{labels,datasets:[{label:'å¿œç­”ç‡',data:data.answerRT,borderColor:'#495057',...lineCommon}]},
        options:{responsive:false,maintainAspectRatio:false,scales:{y:{suggestedMin:80,suggestedMax:100}}}
      }));

      charts.push(new Chart(document.getElementById('chart_ratio').getContext('2d'),{
        type:'line',
        data:{labels,datasets:[{label:'å—ç™ºæ³¨èª²å‡¦ç†æ¯”ç‡(%)',data:data.ratio,borderColor:'#0ca678',...lineCommon}]},
        options:{responsive:false,maintainAspectRatio:false,scales:{y:{suggestedMin:60,suggestedMax:100}}}
      }));
    }

    // PNGä¿å­˜
    document.addEventListener('click', (e)=>{
      const btn=e.target.closest('button[data-png]'); if(!btn) return;
      const id=btn.getAttribute('data-png');
      const canvas=document.getElementById(id);
      const link=document.createElement('a');
      link.download = id + '.png';
      link.href = canvas.toDataURL('image/png');
      link.click();
    });

    buildTable(); renderCharts();
  </script>
</body>
</html>
