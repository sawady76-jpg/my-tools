<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¥­å‹™æ™‚é–“ãƒ»ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç®¡ç†</title>
    <style>
        body {
            font-family: "Helvetica Neue", Arial, sans-serif;
            background-color: #f4f7f6;
            color: #333;
            display: flex;
            justify-content: center;
            padding: 20px;
        }
        .container {
            background: #fff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 600px;
            text-align: center;
        }
        h2 { margin-bottom: 20px; color: #2c3e50; }
        
        /* ç¾åœ¨ã®çŠ¶æ…‹è¡¨ç¤ºã‚¨ãƒªã‚¢ */
        .status-display {
            background-color: #eef2f3;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 25px;
        }
        .current-status {
            font-size: 1.5em;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        .timer {
            font-size: 2.5em;
            font-weight: bold;
            color: #3498db;
            font-family: monospace;
        }

        /* ãƒœã‚¿ãƒ³ã‚¨ãƒªã‚¢ */
        .button-group {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            margin-bottom: 30px;
        }
        button {
            padding: 15px;
            font-size: 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.1s, opacity 0.2s;
            font-weight: bold;
            color: white;
        }
        button:active { transform: scale(0.98); }
        
        .btn-work { background-color: #27ae60; } /* ç·‘ */
        .btn-break { background-color: #f39c12; } /* ã‚ªãƒ¬ãƒ³ã‚¸ */
        .btn-away { background-color: #e74c3c; } /* èµ¤ */
        .btn-finish { 
            background-color: #7f8c8d; 
            grid-column: 1 / -1; /* å…¨å¹… */
            margin-top: 10px;
        }
        
        /* é›†è¨ˆãƒ†ãƒ¼ãƒ–ãƒ« */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            padding: 10px;
            border-bottom: 1px solid #ddd;
            text-align: center;
        }
        th { background-color: #f8f9fa; }
        
        .summary-box {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
            padding: 15px;
            background: #fdfdfd;
            border: 1px solid #eee;
            border-radius: 8px;
        }
        .summary-item strong { display: block; font-size: 1.2em; }
        .summary-item span { font-size: 1.1em; color: #555; }

        .download-link {
            display: block;
            margin-top: 20px;
            color: #3498db;
            text-decoration: none;
            font-size: 0.9em;
        }
    </style>
</head>
<body>

<div class="container">
    <h2>â±ï¸ æ¥­å‹™ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç®¡ç†</h2>

    <div class="status-display">
        <div class="current-status" id="statusText">æœªé–‹å§‹</div>
        <div class="timer" id="timerDisplay">00:00:00</div>
    </div>

    <div class="button-group">
        <button class="btn-work" onclick="changeStatus('æ¥­å‹™ä¸­')">ğŸ’» æ¥­å‹™ä¸­</button>
        <button class="btn-break" onclick="changeStatus('ä¼‘æ†©')">â˜• ä¼‘æ†©</button>
        <button class="btn-away" onclick="changeStatus('é›¢å¸­')">ğŸšª é›¢å¸­</button>
        <button class="btn-finish" onclick="finishDay()">ğŸ æ¥­å‹™çµ‚äº†ï¼ˆé›†è¨ˆç¢ºå®šï¼‰</button>
    </div>

    <div class="summary-box">
        <div class="summary-item">
            <strong>æ¥­å‹™</strong>
            <span id="totalWork">0åˆ†</span>
        </div>
        <div class="summary-item">
            <strong>ä¼‘æ†©</strong>
            <span id="totalBreak">0åˆ†</span>
        </div>
        <div class="summary-item">
            <strong>é›¢å¸­</strong>
            <span id="totalAway">0åˆ†</span>
        </div>
    </div>

    <h3>æœ¬æ—¥ã®å±¥æ­´</h3>
    <table id="logTable">
        <thead>
            <tr>
                <th>çŠ¶æ…‹</th>
                <th>é–‹å§‹</th>
                <th>çµ‚äº†</th>
                <th>æ™‚é–“</th>
            </tr>
        </thead>
        <tbody>
            </tbody>
    </table>

    <a href="#" class="download-link" onclick="downloadCSV()">ğŸ“¥ å±¥æ­´ã‚’CSVã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</a>
    <div style="margin-top:10px; font-size:0.8em; color:#999; cursor:pointer;" onclick="resetData()">[ãƒ‡ãƒ¼ã‚¿å…¨æ¶ˆå»ï¼ˆãƒªã‚»ãƒƒãƒˆï¼‰]</div>
</div>

<script>
    let currentStatus = "æœªé–‹å§‹";
    let startTime = null;
    let timerInterval = null;
    let logs = JSON.parse(localStorage.getItem('workLogs')) || [];

    // åˆæœŸåŒ–å‡¦ç†
    window.onload = function() {
        renderLogs();
        calculateTotals();
    };

    function changeStatus(newStatus) {
        const now = new Date();

        // æ—¢ã«è¨ˆæ¸¬ä¸­ã®å ´åˆã€å‰ã®ãƒ­ã‚°ã‚’è¨˜éŒ²
        if (currentStatus !== "æœªé–‹å§‹" && startTime) {
            addLog(currentStatus, startTime, now);
        }

        // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°
        currentStatus = newStatus;
        startTime = now;
        
        // UIæ›´æ–°
        document.getElementById('statusText').innerText = currentStatus;
        document.getElementById('statusText').style.color = getStatusColor(currentStatus);
        
        // ã‚¿ã‚¤ãƒãƒ¼ãƒªã‚»ãƒƒãƒˆï¼†ã‚¹ã‚¿ãƒ¼ãƒˆ
        clearInterval(timerInterval);
        updateTimerDisplay(0);
        timerInterval = setInterval(() => {
            const diff = Math.floor((new Date() - startTime) / 1000);
            updateTimerDisplay(diff);
        }, 1000);
    }

    function finishDay() {
        const now = new Date();
        if (currentStatus !== "æœªé–‹å§‹" && startTime) {
            addLog(currentStatus, startTime, now);
        }
        
        clearInterval(timerInterval);
        currentStatus = "æ¥­å‹™çµ‚äº†";
        startTime = null;
        document.getElementById('statusText').innerText = "æ¥­å‹™çµ‚äº†";
        document.getElementById('timerDisplay').innerText = "00:00:00";
        alert("ãŠç–²ã‚Œæ§˜ã§ã—ãŸã€‚æœ¬æ—¥ã®æ¥­å‹™ã‚’é›†è¨ˆã—ã¾ã—ãŸã€‚");
    }

    function addLog(status, start, end) {
        const durationSeconds = Math.floor((end - start) / 1000);
        const log = {
            status: status,
            start: start.toLocaleTimeString(),
            end: end.toLocaleTimeString(),
            duration: durationSeconds,
            durationStr: formatTime(durationSeconds)
        };
        logs.push(log);
        localStorage.setItem('workLogs', JSON.stringify(logs));
        renderLogs();
        calculateTotals();
    }

    function renderLogs() {
        const tbody = document.querySelector('#logTable tbody');
        tbody.innerHTML = '';
        // æ–°ã—ã„é †ã«è¡¨ç¤º
        logs.slice().reverse().forEach(log => {
            const tr = document.createElement('tr');
            tr.innerHTML = `<td>${log.status}</td><td>${log.start}</td><td>${log.end}</td><td>${log.durationStr}</td>`;
            tbody.appendChild(tr);
        });
    }

    function calculateTotals() {
        let totals = { "æ¥­å‹™ä¸­": 0, "ä¼‘æ†©": 0, "é›¢å¸­": 0 };
        
        logs.forEach(log => {
            if (totals[log.status] !== undefined) {
                totals[log.status] += log.duration;
            }
        });

        document.getElementById('totalWork').innerText = Math.floor(totals["æ¥­å‹™ä¸­"] / 60) + "åˆ†";
        document.getElementById('totalBreak').innerText = Math.floor(totals["ä¼‘æ†©"] / 60) + "åˆ†";
        document.getElementById('totalAway').innerText = Math.floor(totals["é›¢å¸­"] / 60) + "åˆ†";
    }

    // è£œåŠ©é–¢æ•°
    function updateTimerDisplay(seconds) {
        document.getElementById('timerDisplay').innerText = formatTime(seconds);
    }

    function formatTime(seconds) {
        const h = Math.floor(seconds / 3600).toString().padStart(2, '0');
        const m = Math.floor((seconds % 3600) / 60).toString().padStart(2, '0');
        const s = (seconds % 60).toString().padStart(2, '0');
        return `${h}:${m}:${s}`;
    }

    function getStatusColor(status) {
        if (status === 'æ¥­å‹™ä¸­') return '#27ae60';
        if (status === 'ä¼‘æ†©') return '#f39c12';
        if (status === 'é›¢å¸­') return '#e74c3c';
        return '#333';
    }

    function downloadCSV() {
        let csvContent = "data:text/csv;charset=utf-8,\uFEFF"; // BOMä»˜ã
        csvContent += "ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹,é–‹å§‹æ™‚é–“,çµ‚äº†æ™‚é–“,çµŒéæ™‚é–“\n";
        
        logs.forEach(log => {
            csvContent += `${log.status},${log.start},${log.end},${log.durationStr}\n`;
        });

        const encodedUri = encodeURI(csvContent);
        const link = document.createElement("a");
        link.setAttribute("href", encodedUri);
        link.setAttribute("download", "my_work_log.csv");
        document.body.appendChild(link);
        link.click();
    }

    function resetData() {
        if(confirm("å±¥æ­´ã‚’ã™ã¹ã¦å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) {
            localStorage.removeItem('workLogs');
            logs = [];
            renderLogs();
            calculateTotals();
            location.reload();
        }
    }
</script>

</body>
</html>