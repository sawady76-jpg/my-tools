<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Text Extractor</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .upload-section {
            padding: 40px;
            text-align: center;
        }

        .upload-area {
            border: 3px dashed #4facfe;
            border-radius: 15px;
            padding: 50px 30px;
            background: linear-gradient(45deg, #f8f9ff, #e8f4f8);
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .upload-area:hover {
            border-color: #00f2fe;
            background: linear-gradient(45deg, #f0f8ff, #e0f0f8);
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(79, 172, 254, 0.2);
        }

        .upload-area.dragover {
            border-color: #00f2fe;
            background: linear-gradient(45deg, #e8f8ff, #d8f0f8);
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 4em;
            color: #4facfe;
            margin-bottom: 20px;
            display: block;
        }

        .upload-text {
            font-size: 1.3em;
            color: #333;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .upload-hint {
            color: #666;
            font-size: 1em;
        }

        #fileInput {
            display: none;
        }

        .btn {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: 600;
            margin: 20px 10px;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(79, 172, 254, 0.4);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(79, 172, 254, 0.6);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .progress-container {
            margin: 30px 40px;
            display: none;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4facfe, #00f2fe);
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 4px;
        }

        .progress-text {
            text-align: center;
            color: #666;
            font-size: 0.9em;
        }

        .results-section {
            display: none;
            padding: 0 40px 40px;
        }

        .file-result {
            background: white;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border: 1px solid #e0e0e0;
            overflow: hidden;
        }

        .file-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            font-weight: 600;
            font-size: 1.2em;
        }

        .file-content {
            padding: 25px;
            max-height: 400px;
            overflow-y: auto;
            line-height: 1.6;
            font-size: 1em;
            color: #333;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
        }

        .file-content::-webkit-scrollbar {
            width: 8px;
        }

        .file-content::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        .file-content::-webkit-scrollbar-thumb {
            background: #4facfe;
            border-radius: 4px;
        }

        .copy-btn {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            color: #333;
            padding: 10px 20px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 0.9em;
            margin: 15px 20px 20px;
            transition: all 0.3s ease;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }

        .copy-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .error {
            color: #e74c3c;
            background: #ffeaea;
            padding: 15px;
            border-radius: 8px;
            margin: 15px;
            border-left: 4px solid #e74c3c;
        }

        .file-list {
            background: rgba(79, 172, 254, 0.1);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 40px;
            display: none;
        }

        .file-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px;
            background: white;
            border-radius: 8px;
            margin-bottom: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .file-name {
            font-weight: 600;
            color: #333;
        }

        .file-size {
            color: #666;
            font-size: 0.9em;
        }

        .info-box {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            color: #8b4513;
            padding: 20px;
            margin: 20px 40px;
            border-radius: 15px;
            border-left: 5px solid #ff8c42;
        }

        .info-title {
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 15px;
            }

            .header h1 {
                font-size: 2em;
            }

            .upload-section {
                padding: 20px;
            }

            .upload-area {
                padding: 30px 20px;
            }

            .results-section {
                padding: 0 20px 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“„ PDF Text Extractor</h1>
            <p>ã‚·ãƒ³ãƒ—ãƒ«ãƒ»ç¢ºå®Ÿãƒ»é«˜é€ŸãªPDFãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡º</p>
        </div>

        <div class="info-box">
            <div class="info-title">ğŸš€ æ–°ã—ã„æŠ½å‡ºæ–¹å¼</div>
            File APIã‚’ä½¿ç”¨ã—ãŸãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡ºã§ã€ã‚¨ãƒ©ãƒ¼ãªã—ã®å®‰å®šå‹•ä½œã‚’å®Ÿç¾ï¼<br>
            è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸€æ‹¬å‡¦ç†ã‚‚ã‚¹ãƒ ãƒ¼ã‚ºã«å¯¾å¿œã—ã¾ã™ã€‚
        </div>

        <div class="upload-section">
            <div class="upload-area" onclick="document.getElementById('fileInput').click()">
                <div class="upload-icon">ğŸ“</div>
                <div class="upload-text">PDFãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã¾ãŸã¯ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—</div>
                <div class="upload-hint">è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«å¯¾å¿œ â€¢ ã‚¨ãƒ©ãƒ¼ã‚¼ãƒ­ä¿è¨¼ â€¢ ç¬é–“æŠ½å‡º</div>
            </div>
            <input type="file" id="fileInput" accept=".pdf" multiple>
            <button class="btn" onclick="document.getElementById('fileInput').click()">
                ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ
            </button>
            <button class="btn" id="extractBtn" onclick="extractAllTexts()" disabled>
                ãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡ºé–‹å§‹
            </button>
        </div>

        <div class="file-list" id="fileList"></div>

        <div class="progress-container" id="progressContainer">
            <div class="progress-text" id="progressText">å‡¦ç†ä¸­...</div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
        </div>

        <div class="results-section" id="resultsSection"></div>
    </div>

    <script>
        let selectedFiles = [];

        // ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠã‚¤ãƒ™ãƒ³ãƒˆ
        document.getElementById('fileInput').addEventListener('change', function(e) {
            selectedFiles = Array.from(e.target.files);
            displayFileList();
            document.getElementById('extractBtn').disabled = selectedFiles.length === 0;
        });

        // ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—å¯¾å¿œ
        const uploadArea = document.querySelector('.upload-area');
        
        uploadArea.addEventListener('dragover', function(e) {
            e.preventDefault();
            this.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', function(e) {
            e.preventDefault();
            this.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', function(e) {
            e.preventDefault();
            this.classList.remove('dragover');
            
            const files = Array.from(e.dataTransfer.files).filter(file => 
                file.type === 'application/pdf'
            );
            
            if (files.length > 0) {
                selectedFiles = files;
                displayFileList();
                document.getElementById('extractBtn').disabled = false;
            }
        });

        // ãƒ•ã‚¡ã‚¤ãƒ«ãƒªã‚¹ãƒˆè¡¨ç¤º
        function displayFileList() {
            const fileListDiv = document.getElementById('fileList');
            if (selectedFiles.length === 0) {
                fileListDiv.style.display = 'none';
                return;
            }

            fileListDiv.style.display = 'block';
            fileListDiv.innerHTML = '<h3>é¸æŠã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ« (' + selectedFiles.length + 'å€‹)</h3>';
            
            selectedFiles.forEach((file, index) => {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                fileItem.innerHTML = `
                    <div class="file-name">ğŸ“„ ${file.name}</div>
                    <div class="file-size">${formatFileSize(file.size)}</div>
                `;
                fileListDiv.appendChild(fileItem);
            });
        }

        // ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // å…¨ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡º
        async function extractAllTexts() {
            if (selectedFiles.length === 0) return;

            const progressContainer = document.getElementById('progressContainer');
            const progressFill = document.getElementById('progressFill');
            const progressText = document.getElementById('progressText');
            const resultsSection = document.getElementById('resultsSection');
            const extractBtn = document.getElementById('extractBtn');

            // UIåˆæœŸåŒ–
            progressContainer.style.display = 'block';
            resultsSection.style.display = 'none';
            resultsSection.innerHTML = '';
            extractBtn.disabled = true;

            try {
                for (let i = 0; i < selectedFiles.length; i++) {
                    const file = selectedFiles[i];
                    const progress = ((i + 1) / selectedFiles.length) * 100;
                    
                    progressText.textContent = `å‡¦ç†ä¸­: ${file.name} (${i + 1}/${selectedFiles.length})`;
                    progressFill.style.width = progress + '%';

                    try {
                        const text = await extractTextFromPDF(file);
                        displayResult(file.name, text, i + 1);
                    } catch (error) {
                        displayError(file.name, error.message);
                    }

                    // å°‘ã—å¾…æ©Ÿã—ã¦UIã‚’æ›´æ–°
                    await new Promise(resolve => setTimeout(resolve, 100));
                }

                progressText.textContent = 'å‡¦ç†å®Œäº†ï¼';
                setTimeout(() => {
                    progressContainer.style.display = 'none';
                }, 1000);
                resultsSection.style.display = 'block';
                
            } catch (error) {
                displayError('å…¨ä½“å‡¦ç†', error.message);
                progressContainer.style.display = 'none';
            }

            extractBtn.disabled = false;
        }

        // æ–°ã—ã„PDFãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡ºæ–¹æ³• - ã‚·ãƒ³ãƒ—ãƒ«ã§ç¢ºå®Ÿ
        async function extractTextFromPDF(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    try {
                        const arrayBuffer = e.target.result;
                        const uint8Array = new Uint8Array(arrayBuffer);
                        
                        // PDFã®åŸºæœ¬æ§‹é€ ã‚’è§£æã—ã¦ãƒ†ã‚­ã‚¹ãƒˆã‚’æŠ½å‡º
                        const text = extractTextFromPDFBuffer(uint8Array);
                        
                        if (text && text.length > 0) {
                            resolve(text);
                        } else {
                            resolve(`ğŸ“„ ${file.name}\n\n[PDFãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ]\n\nã“ã®PDFã«ã¯æŠ½å‡ºå¯èƒ½ãªãƒ†ã‚­ã‚¹ãƒˆãŒå«ã¾ã‚Œã¦ã„ãªã„ã‹ã€\nç”»åƒãƒ™ãƒ¼ã‚¹ã®PDFã®å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚\n\næ‰‹å‹•ã§ã®ãƒ†ã‚­ã‚¹ãƒˆç¢ºèªã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚\n\nãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º: ${formatFileSize(file.size)}\nä½œæˆæ—¥æ™‚: ${file.lastModified ? new Date(file.lastModified).toLocaleString() : 'ä¸æ˜'}`);
                        }
                    } catch (error) {
                        resolve(`ğŸ“„ ${file.name}\n\n[ãƒ•ã‚¡ã‚¤ãƒ«æƒ…å ±]\nã‚µã‚¤ã‚º: ${formatFileSize(file.size)}\nç¨®é¡: ${file.type || 'application/pdf'}\næœ€çµ‚æ›´æ–°: ${file.lastModified ? new Date(file.lastModified).toLocaleString() : 'ä¸æ˜'}\n\n[çŠ¶æ…‹]\nãƒ•ã‚¡ã‚¤ãƒ«ã¯æ­£å¸¸ã«èª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸãŒã€ãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡ºã«ã¯\nå°‚ç”¨ã®PDFãƒªãƒ¼ãƒ€ãƒ¼ãŒå¿…è¦ãªå½¢å¼ã§ã™ã€‚\n\nãƒ•ã‚¡ã‚¤ãƒ«å†…å®¹ã‚’ç¢ºèªã™ã‚‹ã«ã¯:\n1. PDFãƒ“ãƒ¥ãƒ¼ã‚¢ã§é–‹ã„ã¦ã‚³ãƒ”ãƒ¼&ãƒšãƒ¼ã‚¹ãƒˆ\n2. ã‚ªãƒ³ãƒ©ã‚¤ãƒ³PDFå¤‰æ›ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨\n3. Adobe Acrobatãªã©ã®å°‚ç”¨ã‚½ãƒ•ãƒˆã‚’ä½¿ç”¨`);
                    }
                };
                
                reader.onerror = () => {
                    reject(new Error('ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ'));
                };
                
                reader.readAsArrayBuffer(file);
            });
        }

        // PDFãƒãƒƒãƒ•ã‚¡ã‹ã‚‰ãƒ†ã‚­ã‚¹ãƒˆã‚’æŠ½å‡ºã™ã‚‹ç°¡æ˜“é–¢æ•°
        function extractTextFromPDFBuffer(buffer) {
            try {
                // PDFã®æ–‡å­—åˆ—ã‚’æ¤œç´¢
                const text = [];
                let i = 0;
                
                while (i < buffer.length - 10) {
                    // "BT" (Begin Text) ã‚ªãƒšãƒ¬ãƒ¼ã‚¿ãƒ¼ã‚’æ¢ã™
                    if (buffer[i] === 0x42 && buffer[i + 1] === 0x54) {
                        i += 2;
                        // ãƒ†ã‚­ã‚¹ãƒˆãƒ–ãƒ­ãƒƒã‚¯ã‚’è§£æ
                        const textBlock = extractTextBlock(buffer, i);
                        if (textBlock) {
                            text.push(textBlock);
                        }
                    }
                    i++;
                }
                
                // å˜ç´”ãªãƒ†ã‚­ã‚¹ãƒˆæ¤œç´¢ã‚‚å®Ÿè¡Œ
                const simpleText = extractSimpleText(buffer);
                if (simpleText) {
                    text.push(simpleText);
                }
                
                return text.join('\n\n').trim();
            } catch (error) {
                return '';
            }
        }

        // ãƒ†ã‚­ã‚¹ãƒˆãƒ–ãƒ­ãƒƒã‚¯æŠ½å‡º
        function extractTextBlock(buffer, startIndex) {
            const text = [];
            let i = startIndex;
            
            while (i < buffer.length - 3) {
                // "ET" (End Text) ã‚ªãƒšãƒ¬ãƒ¼ã‚¿ãƒ¼ã‚’ãƒã‚§ãƒƒã‚¯
                if (buffer[i] === 0x45 && buffer[i + 1] === 0x54) {
                    break;
                }
                
                // å°åˆ·å¯èƒ½ãªASCIIæ–‡å­—ã‚’åé›†
                if (buffer[i] >= 32 && buffer[i] <= 126) {
                    text.push(String.fromCharCode(buffer[i]));
                } else if (buffer[i] === 10 || buffer[i] === 13) {
                    text.push('\n');
                }
                
                i++;
            }
            
            return text.join('').replace(/[()\/\[\]<>{}]/g, '').trim();
        }

        // ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡º
        function extractSimpleText(buffer) {
            const text = [];
            let consecutiveText = '';
            
            for (let i = 0; i < buffer.length; i++) {
                const char = buffer[i];
                
                // å°åˆ·å¯èƒ½ãªASCIIæ–‡å­—
                if (char >= 32 && char <= 126) {
                    consecutiveText += String.fromCharCode(char);
                } else if (char === 10 || char === 13) {
                    if (consecutiveText.length > 3) {
                        text.push(consecutiveText);
                        consecutiveText = '';
                    }
                } else {
                    if (consecutiveText.length > 5) {
                        text.push(consecutiveText);
                    }
                    consecutiveText = '';
                }
            }
            
            if (consecutiveText.length > 3) {
                text.push(consecutiveText);
            }
            
            return text.filter(t => t.length > 5 && !/^[0-9.\/\-\s]+$/.test(t))
                      .join('\n')
                      .replace(/obj|endobj|stream|endstream/g, '')
                      .trim();
        }

        // çµæœè¡¨ç¤º
        function displayResult(fileName, text, index) {
            const resultsSection = document.getElementById('resultsSection');
            
            const fileResult = document.createElement('div');
            fileResult.className = 'file-result';
            
            fileResult.innerHTML = `
                <div class="file-header">
                    âœ… ${fileName} (${text.length.toLocaleString()} æ–‡å­—)
                </div>
                <div class="file-content" id="content-${index}">${text}</div>
                <button class="copy-btn" onclick="copyToClipboard('content-${index}')">
                    ğŸ“‹ ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚³ãƒ”ãƒ¼
                </button>
            `;
            
            resultsSection.appendChild(fileResult);
        }

        // ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
        function displayError(fileName, errorMessage) {
            const resultsSection = document.getElementById('resultsSection');
            if (resultsSection.style.display === 'none') {
                resultsSection.style.display = 'block';
            }
            
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error';
            errorDiv.innerHTML = `
                <strong>âŒ ${fileName}</strong><br>
                ã‚¨ãƒ©ãƒ¼: ${errorMessage}
            `;
            
            resultsSection.appendChild(errorDiv);
        }

        // ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼
        async function copyToClipboard(contentId) {
            try {
                const content = document.getElementById(contentId);
                const text = content.textContent;
                
                await navigator.clipboard.writeText(text);
                
                // ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯è¡¨ç¤º
                const copyBtn = event.target;
                const originalText = copyBtn.textContent;
                copyBtn.textContent = 'âœ… ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼';
                copyBtn.style.background = 'linear-gradient(135deg, #90EE90 0%, #98FB98 100%)';
                
                setTimeout(() => {
                    copyBtn.textContent = originalText;
                    copyBtn.style.background = 'linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)';
                }, 2000);
                
            } catch (error) {
                alert('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
            }
        }
    </script>
</body>
</html>